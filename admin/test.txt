<?php
require_once __DIR__ . '/../assets/config/configurationprincipale.php';


$page_title = 'Gestion annonces'; 
include __DIR__ . '/../assets/includes/header_admin.php';
?>
<h2 class="text-center mt-5 mb-5">Gestion des annonces</h2>


<?php     
//Préparation puis execution de la requete pour le tableau
        $query = "SELECT a.id_annonce, a.titreA, a.description_courte, a.description_longue, a.prix, a.pays, a.ville, a.cp, a.adresse, a.cp, a.date_enregistrement, m.prenom, c.titre, p.photo1
        FROM annonce a, membre m, categorie c, photo p
        WHERE a.membre_id = m.id_membre
        AND a.categorie_id = c.id_categorie
        AND a.photo_id = p.id_photo";

    try {
        $req = $pdo->prepare($query);
        $req->execute();
        $NbreDonnee = $req->rowCount();	// nombre d'enregistrements (lignes)
        $ligneToute = $req->fetchAll();
    } catch (PDOException $e){ echo 'Erreur SQL : '. $e->getMessage().'<br/>'; die(); }


    // affichage du tableau
    if ($NbreDonnee != 0) 
    {
    ?>
    <h3 class="m-5">Tableaux des annonces</h3>

    <div class="row justify-content-center">
        <form>
                <div class="form-group">
                        <div>
                            <select>
                                <option>Trier par catégorie</option>
                                
                            </select>
                        </div>
                </div>
        </form>
    </div>

    <hr>

    
        <table border="2" class="table table-bordered table-striped table-hover">
        <thead class="thead-dark text-center">
            <tr>
                <th>id annonce</th>
                <th>titre</th>
                <th>description courte</th>
                <th>description longue</th>
                <th>prix</th>
                <th>photo</th>
                <th>pays</th>
                <th>ville</th>
                <th>adresse</th>
                <th>cp</th>
                <th>membre</th>
                <th>catégorie</th>
                <th>date_enregistrement</th>
                <th>actions</th>
            </tr>
        </thead>
        <tbody>
    <?php
        // Début de la condition Foreach : pour chaque ligne (chaque enregistrement)
        foreach ( $ligneToute as $ligne ) 
        {
            // DONNEES A AFFICHER dans chaque cellule de la ligne
    ?>
            <tr>
                <td><?php echo $ligne['id_annonce']; ?></td>
                <td><?=$ligne['titreA']; ?></td>
                <td><?=$ligne['description_courte']; ?></td>
                <td><?=$ligne['description_longue']; ?></td>
                <td><?=number_format($ligne['prix'], 2, ',', ' ');?></td>

                <td><img src="../assets/img/<?= $ligne['photo1']; ?>" class="img-thumbnail"></td>

                <td><?=$ligne['pays']; ?></td>
                <td><?=$ligne['ville']; ?></td>
                <td><?=$ligne['adresse']; ?></td>
                <td><?=$ligne['cp']; ?></td>
                <td><?=$ligne['prenom']; ?></td>
                <td><?=$ligne['titre']; ?></td>
                <td><?=$ligne['date_enregistrement']; ?></td>
                <td>
                    <a class="btn btn-primary" id="btnVoir" href="fiche_annonce.php?id=<?= $ligne['id_annonce'] ?>" role="button"><i class="fa fa-eye" aria-hidden="true"></i></a>
                    <a class="btn btn-primary" id="btnEdit" href="../annonce_ajout.php?id=<?= $ligne['id_annonce'] ?>" role="button"><i class="far fa-edit" aria-hidden="true"></i></a>
                    <a class="btn btn-primary"  id="btnSuppr" href="fiche_annonce.php?id=<?= $ligne['id_annonce'] ?>" role="button"><i class="far fa-trash-alt" aria-hidden="true"></i></a> 
                </td>
            </tr>
    <?php
        } // Fin condition foreach
    ?>
        </tbody>
        </table>
    
    <?php
        } else { 
            echo 'Il n\'y a aucune annonce à afficher.';
        }
        //Fin condition if
    ?>


  













<?php

include __DIR__ . '/../assets/includes/footer_admin.php';